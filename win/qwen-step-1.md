## üìå –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —ç—Ç–∞–ø 1: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –¶–° (Enterprise Root CA) –Ω–∞ Windows Server 2025

> **–í–∞–∂–Ω–æ:** –°–ª–µ–¥—É–π—Ç–µ **—Å—Ç—Ä–æ–≥–æ** —ç—Ç–∏–º —à–∞–≥–∞–º ‚Äî –ª—é–±–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ö–µ–º—ã –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —à—Ç—Ä–∞—Ñ—É –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ò–ë. –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ **RRAS1**, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –∫ DC.

---

### üîß –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏ Active Directory Certificate Services (–Ω–∞ DC)

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Server Manager** ‚Üí **Manage** ‚Üí **Add Roles and Features**
2. –í—ã–±–µ—Ä–∏—Ç–µ:
   - Installation Type: **Role-based or feature-based installation**
   - Server Selection: **DC** (192.168.100.1)
   - Server Roles: ‚úÖ **Active Directory Certificate Services**
     - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Äî **Add Features**
3. –ù–∞ —ç–∫—Ä–∞–Ω–µ **Role Services** –≤—ã–±–µ—Ä–∏—Ç–µ:
   - ‚úÖ **Certification Authority** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - ‚úÖ **Certification Authority Web Enrollment** (–¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
   - ‚úÖ **Certificate Enrollment Web Service** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - ‚úÖ **Certificate Enrollment Policy Web Service** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É ‚Üí **Install**

> ‚è±Ô∏è –û–∂–∏–¥–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (~3‚Äì5 –º–∏–Ω—É—Ç)

---

### üîê –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Enterprise Root CA (–Ω–∞ DC)

1. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ **Server Manager** –ø–æ—è–≤–∏—Ç—Å—è —Ñ–ª–∞–≥ ‚ö†Ô∏è ‚Üí –∫–ª–∏–∫–Ω–∏—Ç–µ ‚Üí **Configure Active Directory Certificate Services**
2. –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è **Configuration Wizard**:
   - Credentials: –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —É—á—ë—Ç–Ω—É—é –∑–∞–ø–∏—Å—å (`reaskills2026\Administrator`)
   - Role Services: ‚úÖ **Certification Authority**
3. **Setup Type**: ‚úÖ **Enterprise CA**
4. **CA Type**: ‚úÖ **Root CA**
5. **Private Key**: 
   - ‚úÖ **Create a new private key**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (RSA, 4096-bit)
6. **Cryptographic Algorithm**:
   - Hash Algorithm: **SHA256**
7. **CA Name**:
   - Common name: **REA2026-CA**
   - Distinguished name suffix: `DC=reaskills2026,DC=local`
8. **Validity Period**: **20 years**
9. **Certificate Database**:
   - Database location: `C:\Windows\system32\CertLog`
   - Log location: `C:\Windows\system32\CertLog`
10. –ù–∞–∂–º–∏—Ç–µ **Configure** ‚Üí –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (~2 –º–∏–Ω—É—Ç—ã)

---

### üåê –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ CRL (–±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º)

#### 3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–Ω–∞ DC)

```powershell
# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
New-Item -Path "C:\CertEnroll" -ItemType Directory -Force

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ CA
certutil -setreg CA\CRLPublicationURLs "1:file://\\?\C:\CertEnroll\%3%8.crl"
certutil -setreg CA\CACertPublicationURLs "1:file://\\?\C:\CertEnroll\%3%8.crt"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É CA
Restart-Service certsvc -Force
```

> ‚úÖ **–ü–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ:**  
> - –í—Å–µ –ø—É—Ç–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç **—Ç–æ–ª—å–∫–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É** `C:\CertEnroll`  
> - **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤–Ω–µ—à–Ω–∏–π URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¶–° (–æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ RRAS1)  
> - **–ó–∞–ø—Ä–µ—â–µ–Ω–æ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–º–µ–Ω–∞ (`dc`) –∏–ª–∏ IP-–∞–¥—Ä–µ—Å–∞ –≤ –ø—É–±–ª–∏–∫—É–µ–º—ã—Ö –ø—É—Ç—è—Ö

#### 3.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ IIS –Ω–∞ RRAS1 (–¥–ª—è –≤–Ω–µ—à–Ω–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)

1. –ù–∞ **RRAS1** (192.168.122.x) —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–æ–ª—å **Web Server (IIS)**:
   ```powershell
   Install-WindowsFeature -Name Web-Server -IncludeManagementTools
   ```
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è CRL:
   ```powershell   New-Item -Path "C:\inetpub\wwwroot\crl" -ItemType Directory -Force
   ```
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥:
   - –û—Ç–∫—Ä–æ–π—Ç–µ **IIS Manager**
   - –ü–ö–ú –Ω–∞ **Default Web Site** ‚Üí **Add Virtual Directory...**
     - Alias: `crl`
     - Physical path: `C:\inetpub\wwwroot\crl`

#### 3.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–∞–Ω–∞–ª)

```powershell
# –ù–∞ DC —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
$trigger = New-ScheduledTaskTrigger -AtStartup -At (Get-Date) -Once -At (Get-Date).AddMinutes(10)
$action = New-ScheduledTaskAction -Execute "robocopy.exe" -Argument '"C:\CertEnroll" "\\rras1.reaskills2026.local\crl$" *.crl *.crt /R:2 /W:5 /NP /LOG:C:\logs\crl_sync.log'
Register-ScheduledTask -TaskName "CRL_Sync" -Trigger $trigger -Action $action -User "SYSTEM" -RunLevel Highest
```

> ‚úÖ **–ü–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ:**  
> - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –∫–∞–Ω–∞–ª—É** (192.168.100.0/24 ‚Üí 192.168.122.0/24)  
> - –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ –Ω–∞ DC  
> - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞** –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

#### 3.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```powershell
# –ù–∞ RRAS1 —Å–æ–∑–¥–∞–π—Ç–µ DNS-–∑–∞–ø–∏—Å—å
Add-DnsServerPrimaryZone -Name "rea26.ru" -ZoneFile "rea26.ru.dns" -ComputerName "RRAS1"
Add-DnsServerResourceRecordA -Name "crl" -ZoneName "rea26.ru" -IPv4Address "11.11.11.254" -ComputerName "RRAS1"
```

> ‚úÖ **–ü–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ:**  
> - –í–Ω–µ—à–Ω–∏–π IP `11.11.11.254` –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É **EXTERNAL** –Ω–∞ RRAS1  
> - –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏  

---

### üîÑ –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ URL –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –¶–° (–Ω–∞ DC)

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Certification Authority** (`certsrv.msc`)
2. –ü–ö–ú –ø–æ **REA2026-CA** ‚Üí **Properties**
3. –í–∫–ª–∞–¥–∫–∞ **Extensions**:
   - –í—ã–¥–µ–ª–∏—Ç–µ **CDP** ‚Üí –Ω–∞–∂–º–∏—Ç–µ **Add...**
   - –í–≤–µ–¥–∏—Ç–µ:
     ```
     http://crl.rea26.ru/crl/%3%8.crl
     ```
   - ‚úÖ **Include in the CDP extension of issued certificates**
   - ‚úÖ **Include in all CRLs. Clients use this to find Delta CRLs**
   - ‚ùå **Publish CRLs to this location** (–æ—Ç–∫–ª—é—á–∏—Ç—å!)
   - ‚ùå **Publish Delta CRLs to this location** (–æ—Ç–∫–ª—é—á–∏—Ç—å!)
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è **AIA** (Authority Information Access):
   - –î–æ–±–∞–≤—å—Ç–µ:
     ```
     http://crl.rea26.ru/cert/%3%8.crt
     ```
   - ‚úÖ **Include in the AIA extension of issued certificates**
   - ‚ùå **Publish certificates to this location** (–æ—Ç–∫–ª—é—á–∏—Ç—å!)

> ‚úÖ **–ü–æ—á–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ:**  
> - –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–π URL** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤  
> - **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ —ç—Ç–æ—Ç URL (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é)  
> - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL, –Ω–æ **–Ω–µ –ø—ã—Ç–∞—é—Ç—Å—è –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å** —Ç—É–¥–∞ –Ω–∞–ø—Ä—è–º—É—é  

---

### ‚úÖ –®–∞–≥ 5: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
|----------|----------|---------------------|--------------|
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è CRL | –ù–∞ DC: `dir C:\CertEnroll` | –ü–æ—è–≤–ª–µ–Ω–∏–µ `.crl` —Ñ–∞–π–ª–æ–≤ | ‚úÖ |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –ù–∞ RRAS1: `dir C:\inetpub\wwwroot\crl` | –ü–æ—è–≤–ª–µ–Ω–∏–µ `.crl` —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç | ‚úÖ |
| –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø | –° CLI-EXT: `curl http://crl.rea26.ru/crl/` | –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ (–±–µ–∑ –æ—à–∏–±–æ–∫ 404) | ‚úÖ |
| –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ | –° CLI-EXT: `curl http://192.168.100.1/crl/` | –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω) | ‚úÖ |
| DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –ù–∞ CLI-EXT: `nslookup crl.rea26.ru` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `11.11.11.254` | ‚úÖ |

---

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:**  
   - –ù–∞ `RRAS1` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω IIS  
   - –í `C:\inetpub\wwwroot\crl` –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  
   - –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç CRL —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `http://crl.rea26.ru`  
   - –ù–µ—Ç –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ –Ω–∞ DC  

2. **–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**  
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `netsh interface portproxy`  
   - –£–∫–∞–∑—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –≤ –ø—É—Ç—è—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–∏  
   - –°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä—è–º—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç—å—é –∏ DC  

> ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **–≠—Ç–∞–ø—É 2 (–∑–∞–ø—Ä–æ—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è ADFS/WAP/RDS)**.  
> **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ CRL** ‚Äî –±–µ–∑ –Ω–µ—ë –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –æ—à–∏–±–∫–∞–º–∏.
